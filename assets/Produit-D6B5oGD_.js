import{r as n,j as e,B as o,H as J,T,J as m,a9 as K,y as x,a7 as V,K as X,I as Z,N as z,O as ee,Q as W,U as r,V as te,W as E,aa as ae,ab as re,Y as ne,Z as se,$ as oe,ac as ie,ad as le,ae as ce,o as de,a0 as he,X as ue,t as c}from"./index-CLLn0rYl.js";const me=()=>{const[p,v]=n.useState([]),[L,O]=n.useState([]),[j,b]=n.useState(0),[d,U]=n.useState(5),[B,P]=n.useState(!0),[$,w]=n.useState(!1),[I,k]=n.useState(""),M=p.filter(t=>t.ProductName.toLowerCase().includes(I.toLowerCase())),[C,S]=n.useState(null),[s,h]=n.useState({ProductID:"",ProductName:"",Category:"",Price:"",Description:"",DateAdded:"",img:""}),[N,y]=n.useState(""),u="http://localhost:5000/api/product",F="http://localhost:5000/api/categories",f=async()=>{try{P(!0);const[t,a]=await Promise.all([c.get(u),c.get(F)]),i=a.data.reduce((l,R)=>(l[R.id]=R.name,l),{}),G=t.data.map(l=>({...l,CategoryName:i[l.Category]||"Unknown"}));v(G),O(a.data),P(!1)}catch(t){console.error("Error fetching data:",t),P(!1)}};n.useEffect(()=>{f()},[]);const A=(t=null)=>{w(!0),t?(S(t),h(t),y(t.img?`http://localhost:5000${t.img}`:"")):(S(null),h({ProductID:"",ProductName:"",Category:"",Price:"",Description:"",DateAdded:"",img:""}),y(""))},D=()=>{w(!1)},H=async()=>{try{const t={...s,DateAdded:new Date().toISOString().split("T")[0]},a=new FormData;a.append("ProductName",t.ProductName),a.append("Category",t.Category),a.append("Price",t.Price),a.append("Description",t.Description),a.append("DateAdded",t.DateAdded),s.img instanceof File?a.append("image",s.img):a.append("img",s.img),C?(await c.put(`${u}/${C.ProductID}`,a),f()):(await c.post(u,a),f()),D()}catch(t){console.error("Error saving product:",t)}},q=async t=>{try{await c.delete(`${u}/${t}`),v(p.filter(a=>a.ProductID!==t))}catch(a){console.error("Error deleting product:",a)}},g=t=>{const{name:a,value:i}=t.target;h({...s,[a]:i})},Q=t=>{const a=t.target.files[0];if(a){const i=URL.createObjectURL(a);y(i),h({...s,img:a})}},_=(t,a)=>{b(a)},Y=t=>{U(+t.target.value),b(0)};return e.jsxs(o,{p:3,children:[e.jsx(J,{children:e.jsx("title",{children:"Product"})}),e.jsx(T,{variant:"h4",gutterBottom:!0,children:"Products"}),e.jsx(o,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:e.jsx(m,{variant:"contained",color:"primary",startIcon:e.jsx(K,{}),onClick:()=>A(),children:"Add"})}),e.jsx(o,{alignItems:"center",mb:4,children:e.jsx(x,{label:"Search by Name",variant:"outlined",value:I,onChange:t=>k(t.target.value),style:{marginRight:"1rem",width:"170vh"}})}),B?e.jsx(o,{display:"flex",justifyContent:"center",mt:4,children:e.jsx(V,{})}):e.jsx(X,{component:Z,children:e.jsxs(z,{children:[e.jsx(ee,{children:e.jsxs(W,{children:[e.jsx(r,{children:"Image"}),e.jsx(r,{children:"Name"}),e.jsx(r,{children:"Price"}),e.jsx(r,{children:"Category"}),e.jsx(r,{children:"Description"}),e.jsx(r,{children:"Date Added"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(te,{children:M.slice(j*d,j*d+d).map(t=>e.jsxs(W,{children:[e.jsx(r,{children:t.img?e.jsx("img",{src:`${t.img}`,alt:t.ProductName,style:{width:50,height:50}}):"No Image"}),e.jsx(r,{children:t.ProductName}),e.jsx(r,{children:t.Price}),e.jsx(r,{children:t.CategoryName}),e.jsx(r,{children:t.Description}),e.jsx(r,{children:t.DateAdded}),e.jsxs(r,{children:[e.jsx(E,{color:"primary",onClick:()=>A(t),children:e.jsx(ae,{})}),e.jsx(E,{color:"error",onClick:()=>q(t.ProductID),children:e.jsx(re,{})})]})]},t.ProductID))})]})}),e.jsxs(ne,{open:$,onClose:D,maxWidth:"sm",fullWidth:!0,children:[e.jsx(se,{children:e.jsx(T,{variant:"h6",component:"div",align:"center",gutterBottom:!0,children:C?"Edit Product":"Add Product"})}),e.jsx(oe,{children:e.jsxs(o,{component:"form",mt:2,display:"flex",flexDirection:"column",gap:2,children:[e.jsx(x,{label:"Product Name",name:"ProductName",value:s.ProductName,onChange:g,fullWidth:!0,margin:"dense",variant:"outlined",required:!0}),e.jsxs(ie,{fullWidth:!0,margin:"dense",children:[e.jsx(le,{children:"Category"}),e.jsx(ce,{name:"Category",value:s.Category,onChange:g,fullWidth:!0,required:!0,children:L.map(t=>e.jsx(de,{value:t.id,children:t.name},t.id))})]}),e.jsx(x,{label:"Price",name:"Price",value:s.Price,onChange:g,fullWidth:!0,margin:"dense",variant:"outlined",type:"number",required:!0}),e.jsx(x,{label:"Description",name:"Description",value:s.Description,onChange:g,fullWidth:!0,margin:"dense",variant:"outlined",multiline:!0,rows:3}),e.jsxs(m,{variant:"contained",component:"label",color:"primary",sx:{alignSelf:"start"},children:["Upload Image",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:Q})]}),N&&e.jsx(o,{mt:2,textAlign:"center",children:e.jsx("img",{src:N,alt:"Preview",style:{maxWidth:"100%",maxHeight:"200px",borderRadius:"8px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)"}})})]})}),e.jsxs(he,{sx:{justifyContent:"space-between",px:3,py:2},children:[e.jsx(m,{onClick:D,variant:"outlined",color:"secondary",sx:{minWidth:120},children:"Cancel"}),e.jsx(m,{onClick:H,variant:"contained",color:"primary",sx:{minWidth:120},children:"Save"})]})]}),e.jsx(ue,{rowsPerPageOptions:[5,10,25],component:"div",count:p.length,rowsPerPage:d,page:j,onPageChange:_,onRowsPerPageChange:Y})]})};export{me as default};
