import{_ as S,aJ as M,aK as D,E as q,r as P,b as w,j as e,c as B,aL as $,d as A,g as E,s as G,u as O,aM as I,a1 as V,a2 as d,aN as _,H as F,G as R,T as c,J as L,B as k,a4 as J,a5 as U,a6 as m,y as u,o as h,Y as z,Z as H,$ as Y,a0 as K}from"./index-DL1FNKyW.js";const Z=["className","component","disableGutters","fixed","maxWidth","classes"],Q=M(),X=D("div",{name:"MuiContainer",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.root,n[`maxWidth${q(String(s.maxWidth))}`],s.fixed&&n.fixed,s.disableGutters&&n.disableGutters]}}),ee=t=>$({props:t,name:"MuiContainer",defaultTheme:Q}),ae=(t,n)=>{const s=l=>E(n,l),{classes:j,fixed:b,disableGutters:g,maxWidth:i}=t,o={root:["root",i&&`maxWidth${q(String(i))}`,b&&"fixed",g&&"disableGutters"]};return A(o,s,j)};function re(t={}){const{createStyledComponent:n=X,useThemeProps:s=ee,componentName:j="MuiContainer"}=t,b=n(({theme:i,ownerState:o})=>S({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",display:"block"},!o.disableGutters&&{paddingLeft:i.spacing(2),paddingRight:i.spacing(2),[i.breakpoints.up("sm")]:{paddingLeft:i.spacing(3),paddingRight:i.spacing(3)}}),({theme:i,ownerState:o})=>o.fixed&&Object.keys(i.breakpoints.values).reduce((l,p)=>{const v=p,a=i.breakpoints.values[v];return a!==0&&(l[i.breakpoints.up(v)]={maxWidth:`${a}${i.breakpoints.unit}`}),l},{}),({theme:i,ownerState:o})=>S({},o.maxWidth==="xs"&&{[i.breakpoints.up("xs")]:{maxWidth:Math.max(i.breakpoints.values.xs,444)}},o.maxWidth&&o.maxWidth!=="xs"&&{[i.breakpoints.up(o.maxWidth)]:{maxWidth:`${i.breakpoints.values[o.maxWidth]}${i.breakpoints.unit}`}}));return P.forwardRef(function(o,l){const p=s(o),{className:v,component:a="div",disableGutters:r=!1,fixed:y=!1,maxWidth:f="lg"}=p,T=w(p,Z),C=S({},p,{component:a,disableGutters:r,fixed:y,maxWidth:f}),x=ae(C,j);return e.jsx(b,S({as:a,ownerState:C,className:B(x.root,v),ref:l},T))})}const ie=re({createStyledComponent:G("div",{name:"MuiContainer",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.root,n[`maxWidth${q(String(s.maxWidth))}`],s.fixed&&n.fixed,s.disableGutters&&n.disableGutters]}}),useThemeProps:t=>O({props:t,name:"MuiContainer"})}),te=I({palette:{primary:{main:"#1976d2"}}}),ne=V({email:d().email("Email invalide").required("Email requis"),cardNumber:d().matches(/^[0-9]{16}$/,"Le numéro de carte doit avoir 16 chiffres").required("Numéro de carte requis"),expiry:d().matches(/^(0[1-9]|1[0-2])\/?([0-9]{2})$/,"MM/AA invalide").required("Date d'expiration requise"),cvc:d().matches(/^[0-9]{3,4}$/,"Le CVC doit être de 3 ou 4 chiffres").required("CVC requis"),cardholderName:d().required("Nom du titulaire requis"),country:d().required("Pays ou région requis"),modePaiement:d().required("Mode de paiement requis"),modeLivraison:d().required("Mode de livraison requis"),delaisLivraison:d().required("Délai de livraison requis")}),se=()=>{const[t,n]=P.useState([]),[s,j]=P.useState(null),[b,g]=P.useState(!1),i={email:"",cardNumber:"",expiry:"",cvc:"",cardholderName:"",country:"",modePaiement:"",modeLivraison:"",delaisLivraison:"",DateCreaction:new Date().toLocaleDateString()};P.useEffect(()=>{if(localStorage.getItem("token")){j(f=>{try{const C=f.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),x=atob(C);return JSON.parse(x)}catch{return null}});const y=JSON.parse(localStorage.getItem("cart")||"[]");n(y)}},[]);const o=async a=>{try{const r=JSON.parse(localStorage.getItem("user")),y=r?r.userId:null,f=t.map(W=>W.img?W.img:"default_image_path.jpg");if(console.log(f),!y){alert("User not found. Please log in again.");return}const T={DateCreaction:a.DateCreaction,modePaiement:a.modePaiement,modeLivraison:a.modeLivraison,delaisLivraison:a.delaisLivraison,idClient:y,img:f},x=await(await fetch("http://localhost:5000/api/verifyCard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cardNumber:a.cardNumber,expiry:a.expiry,cvc:a.cvc,cardholderName:a.cardholderName})})).json();if(x.success){const N=await(await fetch("http://localhost:5000/api/commande",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)})).json();N.success?(console.log("Order placed successfully:",N.message),g(!0)):(console.error("Order placement failed:",N.message),alert(N.message||"An error occurred while placing the order."))}else console.error("Card verification failed:",x.message),alert(x.message||"Card verification failed.")}catch(r){console.error("Error occurred during payment:",r),alert("An error occurred while processing the payment.")}},l=()=>t.reduce((a,r)=>a+r.Price*r.quantity,0),p=()=>{window.location.href="/product"},v=()=>{window.location.href="/orders",localStorage.removeItem("cart")};return e.jsxs(_,{theme:te,children:[e.jsx(F,{children:e.jsx("title",{children:"Checkout"})}),e.jsxs(ie,{style:{marginTop:"5rem",padding:"2rem",border:"1px solid #ccc",borderRadius:"8px",width:"100%"},children:[e.jsxs(R,{container:!0,spacing:4,children:[e.jsxs(R,{item:!0,xs:12,md:6,children:[e.jsx(c,{variant:"h5",gutterBottom:!0,children:"Payer"}),e.jsx(L,{variant:"outlined",color:"primary",onClick:p,style:{marginBottom:"1rem"},children:"Retour au produit"}),t.length>0?e.jsxs(e.Fragment,{children:[t.map(a=>e.jsxs(k,{display:"flex",alignItems:"center",marginBottom:2,children:[e.jsx("img",{src:a.img||"https://via.placeholder.com/50",alt:a.ProductName,style:{marginRight:"1rem",borderRadius:"4px",width:"20%"}}),e.jsxs(k,{children:[e.jsx(c,{variant:"subtitle1",children:a.ProductName}),e.jsx(c,{variant:"body2",color:"textSecondary",children:a.description}),e.jsxs(c,{variant:"body2",style:{marginTop:"0.5rem"},children:["Prix: ",a.Price," ₹ x ",a.quantity," = ",a.Price*a.quantity," €"]})]})]},a.ProductID)),e.jsxs(c,{variant:"h6",style:{marginTop:"1rem"},children:["Montant total du : ",l()," €"]})]}):e.jsx(c,{variant:"subtitle1",color:"textSecondary",children:"Votre panier est vide"}),e.jsx(c,{variant:"h4",gutterBottom:!0,style:{marginTop:"1rem"},children:t.length>0?`Total: ${l()} € `:"Aucun article dans le panier"})]}),e.jsx(R,{item:!0,xs:12,md:6,children:e.jsx(J,{initialValues:i,validationSchema:ne,onSubmit:o,children:({errors:a,touched:r})=>e.jsxs(U,{children:[e.jsx(m,{as:u,fullWidth:!0,name:"email",label:"E-mail",variant:"outlined",margin:"normal",error:r.email&&!!a.email,helperText:r.email&&a.email}),e.jsx(m,{as:u,fullWidth:!0,name:"cardNumber",label:"Informations de la carte",variant:"outlined",margin:"normal",placeholder:"1234 1234 1234 1234",error:r.cardNumber&&!!a.cardNumber,helperText:r.cardNumber&&a.cardNumber}),e.jsxs(k,{display:"flex",justifyContent:"space-between",children:[e.jsx(m,{as:u,name:"expiry",label:"MM / AA",variant:"outlined",margin:"normal",style:{width:"48%"},error:r.expiry&&!!a.expiry,helperText:r.expiry&&a.expiry}),e.jsx(m,{as:u,name:"cvc",label:"CVC",variant:"outlined",margin:"normal",style:{width:"48%"},error:r.cvc&&!!a.cvc,helperText:r.cvc&&a.cvc})]}),e.jsx(m,{as:u,fullWidth:!0,name:"cardholderName",label:"Nom du titulaire de la carte",variant:"outlined",margin:"normal",error:r.cardholderName&&!!a.cardholderName,helperText:r.cardholderName&&a.cardholderName}),e.jsx(m,{as:u,select:!0,fullWidth:!0,name:"country",label:"Pays ou région",variant:"outlined",margin:"normal",error:r.country&&!!a.country,helperText:r.country&&a.country,children:e.jsx(h,{value:"Tunisie",children:"Tunisie"})}),e.jsxs(m,{as:u,select:!0,fullWidth:!0,name:"modePaiement",label:"Mode de paiement",variant:"outlined",margin:"normal",error:r.modePaiement&&!!a.modePaiement,helperText:r.modePaiement&&a.modePaiement,children:[e.jsx(h,{value:"CREDIT_CARD",children:"Carte de Crédit"}),e.jsx(h,{disabled:!0,value:"PAYPAL",children:"PayPal"})]}),e.jsxs(m,{as:u,select:!0,fullWidth:!0,name:"modeLivraison",label:"Mode de livraison",variant:"outlined",margin:"normal",error:r.modeLivraison&&!!a.modeLivraison,helperText:r.modeLivraison&&a.modeLivraison,children:[e.jsx(h,{value:"Standard",children:"Standard"}),e.jsx(h,{value:"Express",children:"Express"})]}),e.jsxs(m,{as:u,select:!0,fullWidth:!0,name:"delaisLivraison",label:"Délai de livraison",variant:"outlined",margin:"normal",error:r.delaisLivraison&&!!a.delaisLivraison,helperText:r.delaisLivraison&&a.delaisLivraison,children:[e.jsx(h,{value:"1-3 jours",children:"1-3 jours"}),e.jsx(h,{value:"3-5 jours",children:"3-5 jours"})]}),e.jsx(L,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,style:{marginTop:"1.5rem"},children:"Payer"})]})})})]}),e.jsx(c,{variant:"caption",display:"block",style:{marginTop:"2rem",textAlign:"center"},children:"Propulsé par"}),e.jsxs(z,{open:b,onClose:()=>g(!1),children:[e.jsx(H,{children:"Votre commande a été passée avec succès!"}),e.jsx(Y,{children:e.jsx(k,{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",children:e.jsx(c,{variant:"h6",children:"Félicitations! Votre commande a été enregistrée."})})}),e.jsxs(K,{children:[e.jsx(L,{onClick:v,color:"primary",children:"Aller à ma commande"}),e.jsx(L,{onClick:()=>g(!1),color:"secondary",children:"Fermer"})]})]})]})]})};export{se as default};
